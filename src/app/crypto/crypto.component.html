<p-toast position="top-center"></p-toast>
<button #searchButton pButton pRipple type="button" label="Search" class="p-button-outlined p-button-secondary"
  (click)="listCryptos()"></button>
<button pButton pRipple type="button" label="Add" class="p-button-outlined p-button-success ml-2"
  (click)="openDialog(null)"></button>

<p class="p-component">Total Price: {{ total | currency: 'USD' }}</p>
<p-table [value]="cryptos" styleClass="p-datatable-striped" [loading]="showSpinner" [scrollable]="true"
  scrollHeight="800px">
  <ng-template pTemplate="header">
    <tr>
      <th></th>
      <th>CMC ID</th>
      <th>Name</th>
      <th>Quantity</th>
      <th>Price</th>
      <th>Total</th>
      <th>Remark</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-crypto>
    <tr>
      <td>
        <button pButton pRipple type="button" icon="pi pi-pencil"
          class="p-button-rounded p-button-primary p-button-text" (click)="openDialog(crypto)"></button>
        <button pButton pRipple type="button" icon="pi pi-trash" class="p-button-rounded p-button-danger p-button-text"
          (click)="confirmDialog($event, crypto.cmc_id)"></button>
      </td>
      <td>{{ crypto.cmc_id }}</td>
      <td>{{ crypto.name }}</td>
      <td>{{ crypto.quantity }}</td>
      <td>{{ crypto.price | currency: 'USD' }}</td>
      <td>{{ crypto.total | currency: 'USD' }}</td>
      <td>{{ crypto.remark }}</td>
    </tr>
  </ng-template>
</p-table>

<p-confirmPopup></p-confirmPopup>

<p-dialog [header]="isEdit ? 'Update Crypto' : 'Add Crypto'" [(visible)]="displayModal" [modal]="true"
  [style]="{width: '50vw'}" [draggable]="false" [resizable]="false">
  <div class="card" [formGroup]="cryptoForm">
    <div class="field mt-4">
      <span class="p-float-label">
        <input id="cmc_id" type="text" pInputText aria-describedby="cmc_id-help" formControlName="cmc_id"
          [ngClass]="{'ng-invalid ng-dirty': isInvalid('cmc_id')}">
        <label for="cmc_id">CMC ID*</label>
      </span>
      <small *ngIf="isInvalid('cmc_id')" id="cmc_id-help" class="p-error">CMC ID is required.</small>
    </div>
    <div class="field mt-4">
      <span class="p-float-label">
        <input id="name" type="text" pInputText aria-describedby="name-help" formControlName="name"
          [ngClass]="{'ng-invalid ng-dirty': isInvalid('name')}">
        <label for="name">Name*</label>
      </span>
      <small *ngIf="isInvalid('name')" id="name-help" class="p-error">Name is required.</small>
    </div>
    <div class="field mt-4">
      <span class="p-float-label">
        <input id="quantity" type="text" pInputText aria-describedby="quantity-help" formControlName="quantity"
          [ngClass]="{'ng-invalid ng-dirty': isInvalid('quantity')}">
        <label for="quantity">Quantity*</label>
      </span>
      <small *ngIf="isInvalid('quantity')" id="quantity-help" class="p-error">Quantity is required.</small>
    </div>
    <div class="field mt-4">
      <span class="p-float-label">
        <input id="remark" type="text" pInputText formControlName="remark">
        <label for="remark">Remark</label>
      </span>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <button pButton pRipple type="button" label="Yes" class="p-button-outlined p-button-success"
      (click)="submitChange()"></button>
    <button pButton pRipple type="button" label="No" class="p-button-outlined p-button-danger"
      (click)="displayModal = false"></button>
  </ng-template>
</p-dialog>